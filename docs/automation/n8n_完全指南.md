# ğŸ¯ n8n å®Œå…¨æŒ‡å— - Think Hard Edition

**é¡¹ç›®**: [n8n - Workflow Automation Platform](https://github.com/n8n-io/n8n)
**æ˜Ÿæ ‡**: 151k+ | **é›†æˆ**: 400+ | **å¼€æº**: Fair-code License
**é‡è¦æ€§**: â­â­â­â­â­ (å·¥ä½œæµè‡ªåŠ¨åŒ–çš„ç»ˆæå·¥å…·)

---

## ğŸ“‹ ç›®å½•

1. [ä»€ä¹ˆæ˜¯ n8n](#1-ä»€ä¹ˆæ˜¯-n8n)
2. [ä¸ºä»€ä¹ˆé€‰æ‹© n8n](#2-ä¸ºä»€ä¹ˆé€‰æ‹©-n8n)
3. [æ ¸å¿ƒæ¶æ„åŸç†](#3-æ ¸å¿ƒæ¶æ„åŸç†)
4. [èŠ‚ç‚¹ç³»ç»Ÿè¯¦è§£](#4-èŠ‚ç‚¹ç³»ç»Ÿè¯¦è§£)
5. [å·¥ä½œæµè®¾è®¡](#5-å·¥ä½œæµè®¾è®¡)
6. [ä»£ç èƒ½åŠ›](#6-ä»£ç èƒ½åŠ›)
7. [AI é›†æˆ](#7-ai-é›†æˆ)
8. [è‡ªæ‰˜ç®¡æŒ‡å—](#8-è‡ªæ‰˜ç®¡æŒ‡å—)
9. [é«˜çº§ç‰¹æ€§](#9-é«˜çº§ç‰¹æ€§)
10. [æ€§èƒ½ä¼˜åŒ–](#10-æ€§èƒ½ä¼˜åŒ–)

---

## 1. ä»€ä¹ˆæ˜¯ n8nï¼Ÿ

### 1.1 æ ¸å¿ƒå®šä¹‰

**n8n** = **n**ode-View + **N**ode.js + auto**mation**

```
n8n æ˜¯ä¸€ä¸ªå¼€æºçš„ã€å¯è‡ªæ‰˜ç®¡çš„å·¥ä½œæµè‡ªåŠ¨åŒ–å¹³å°
     â†“
å…è®¸ä½ åƒæ­ç§¯æœ¨ä¸€æ ·è¿æ¥ 400+ åº”ç”¨å’ŒæœåŠ¡
     â†“
é€šè¿‡å¯è§†åŒ–ç¼–è¾‘å™¨æˆ–ä»£ç ï¼ˆJS/Pythonï¼‰
     â†“
åˆ›å»ºä»ç®€å•åˆ°å¤æ‚çš„è‡ªåŠ¨åŒ–æµç¨‹
```

### 1.2 ä¸‰å¥è¯æ€»ç»“

1. **å·¥ä½œæµè‡ªåŠ¨åŒ–å¹³å°**
   - è¿æ¥ä¸åŒçš„åº”ç”¨å’ŒæœåŠ¡
   - è‡ªåŠ¨æ‰§è¡Œé‡å¤æ€§ä»»åŠ¡
   - æ— éœ€ç¼–ç¨‹ä¹Ÿèƒ½åˆ›å»ºå¤æ‚æµç¨‹

2. **å¼€æºå¯è‡ªæ‰˜ç®¡**
   - æºä»£ç å®Œå…¨å…¬å¼€ï¼ˆFair-code Licenseï¼‰
   - å¯ä»¥éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨
   - æ•°æ®å®Œå…¨æŒæ§ï¼Œæ— ä¾›åº”å•†é”å®š

3. **ä»£ç  + æ— ä»£ç æ··åˆ**
   - å¯è§†åŒ–æ‹–æ‹½ç¼–è¾‘å™¨ï¼ˆæ— ä»£ç ï¼‰
   - æ”¯æŒ JavaScript/Pythonï¼ˆæœ‰ä»£ç ï¼‰
   - AI åŸç”Ÿé›†æˆï¼ˆLangChainï¼‰

### 1.3 å…¸å‹ä½¿ç”¨åœºæ™¯

```
åœºæ™¯ 1: è‡ªåŠ¨åŒ–æ•°æ®æ”¶é›†
YouTube æ–°è§†é¢‘é€šçŸ¥ â†’ ä¸‹è½½å­—å¹• â†’ AI æ€»ç»“ â†’ å­˜å…¥æ•°æ®åº“ â†’ å‘é€æ‘˜è¦

åœºæ™¯ 2: ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–
æ–°è®¢å• â†’ å‘é€ç¡®è®¤é‚®ä»¶ â†’ æ›´æ–°åº“å­˜ â†’ é€šçŸ¥ç‰©æµ â†’ è®°å½•åˆ° CRM

åœºæ™¯ 3: ç¤¾äº¤åª’ä½“ç®¡ç†
å†™åšå®¢ â†’ AI æ”¹å†™å¤šç‰ˆæœ¬ â†’ å®šæ—¶å‘å¸ƒåˆ° Twitter/LinkedIn â†’ æ”¶é›†äº’åŠ¨æ•°æ®

åœºæ™¯ 4: å¼€å‘è¿ç»´è‡ªåŠ¨åŒ–
GitHub PR â†’ è¿è¡Œæµ‹è¯• â†’ éƒ¨ç½²åˆ° Staging â†’ é€šçŸ¥å›¢é˜Ÿ â†’ åˆå¹¶åˆ°ä¸»åˆ†æ”¯
```

### 1.4 æ ¸å¿ƒæ¦‚å¿µ

#### Workflowï¼ˆå·¥ä½œæµï¼‰

```
å·¥ä½œæµ = ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–æ­¥éª¤çš„é›†åˆ

ç¤ºä¾‹ï¼š
[è§¦å‘å™¨] â†’ [æ“ä½œ 1] â†’ [æ“ä½œ 2] â†’ [æ“ä½œ 3] â†’ [ç»“æŸ]
   â†“          â†“          â†“          â†“
æ–°é‚®ä»¶      æå–é™„ä»¶    ä¸Šä¼ åˆ°äº‘ç›˜   å‘é€é€šçŸ¥
```

#### Nodeï¼ˆèŠ‚ç‚¹ï¼‰

```
èŠ‚ç‚¹ = å·¥ä½œæµä¸­çš„å•ä¸ªæ­¥éª¤

ç±»å‹ï¼š
â”œâ”€ Trigger Nodeï¼ˆè§¦å‘èŠ‚ç‚¹ï¼‰ï¼šå¯åŠ¨å·¥ä½œæµ
â”‚   â”œâ”€ Webhookï¼šHTTP è¯·æ±‚è§¦å‘
â”‚   â”œâ”€ Scheduleï¼šå®šæ—¶è§¦å‘
â”‚   â””â”€ Manualï¼šæ‰‹åŠ¨è§¦å‘
â”‚
â”œâ”€ Action Nodeï¼ˆæ“ä½œèŠ‚ç‚¹ï¼‰ï¼šæ‰§è¡Œå…·ä½“ä»»åŠ¡
â”‚   â”œâ”€ HTTP Requestï¼šè°ƒç”¨ API
â”‚   â”œâ”€ Databaseï¼šæ•°æ®åº“æ“ä½œ
â”‚   â””â”€ Transform Dataï¼šæ•°æ®è½¬æ¢
â”‚
â””â”€ Logic Nodeï¼ˆé€»è¾‘èŠ‚ç‚¹ï¼‰ï¼šæ§åˆ¶æµç¨‹
    â”œâ”€ IFï¼šæ¡ä»¶åˆ¤æ–­
    â”œâ”€ Switchï¼šå¤šåˆ†æ”¯
    â””â”€ Loopï¼šå¾ªç¯
```

#### Executionï¼ˆæ‰§è¡Œï¼‰

```
æ‰§è¡Œ = å·¥ä½œæµçš„ä¸€æ¬¡å®Œæ•´è¿è¡Œ

æ¨¡å¼ï¼š
â”œâ”€ Manualï¼šæ‰‹åŠ¨è§¦å‘æ‰§è¡Œ
â”œâ”€ Webhookï¼šå¤–éƒ¨äº‹ä»¶è§¦å‘
â”œâ”€ Scheduleï¼šå®šæ—¶è‡ªåŠ¨æ‰§è¡Œ
â””â”€ Productionï¼šç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨æ‰§è¡Œ
```

---

## 2. ä¸ºä»€ä¹ˆé€‰æ‹© n8nï¼Ÿ

### 2.1 vs ç«å“å¯¹æ¯”

#### n8n vs Zapier

| ç»´åº¦ | n8n | Zapier |
|------|-----|--------|
| **éƒ¨ç½²æ–¹å¼** | è‡ªæ‰˜ç®¡ + äº‘ç«¯ | ä»…äº‘ç«¯ |
| **ä»£ç èƒ½åŠ›** | âœ… å®Œæ•´ JS/Python | âš ï¸ éå¸¸æœ‰é™ |
| **æ•°æ®ä¸»æƒ** | âœ… 100% æŒæ§ | âŒ å­˜å‚¨åœ¨ Zapier |
| **æˆæœ¬ï¼ˆè‡ªæ‰˜ç®¡ï¼‰** | ğŸ’° $0 è½¯ä»¶è´¹ | ğŸ’°ğŸ’°ğŸ’° $20-$2000/æœˆ |
| **é›†æˆæ•°é‡** | 400+ | 7,000+ |
| **AI èƒ½åŠ›** | âœ… LangChain åŸç”Ÿ | âš ï¸ åŸºç¡€ AI èŠ‚ç‚¹ |
| **å­¦ä¹ æ›²çº¿** | ğŸ“ˆ ä¸­ç­‰ï¼ˆéœ€è¦æŠ€æœ¯èƒŒæ™¯ï¼‰ | ğŸ“‰ ä½ï¼ˆéæŠ€æœ¯ç”¨æˆ·ï¼‰ |
| **é€‚åˆåœºæ™¯** | æŠ€æœ¯å›¢é˜Ÿã€å¤æ‚å·¥ä½œæµ | éæŠ€æœ¯ç”¨æˆ·ã€ç®€å•é›†æˆ |

**ç»“è®º**ï¼š
- å¦‚æœä½ æ˜¯æŠ€æœ¯äººå‘˜ â†’ **n8n** å®Œèƒœ
- å¦‚æœéœ€è¦æ•°æ®ä¸»æƒ â†’ **n8n** å”¯ä¸€é€‰æ‹©
- å¦‚æœé«˜é¢‘æ‰§è¡Œï¼ˆ> 10 ä¸‡æ¬¡/æœˆï¼‰â†’ **n8n** è‡ªæ‰˜ç®¡çœé’±
- å¦‚æœéæŠ€æœ¯ä¸”éœ€è¦æµ·é‡é›†æˆ â†’ Zapier æ›´åˆé€‚

#### n8n vs Make (Integromat)

| ç»´åº¦ | n8n | Make |
|------|-----|------|
| **å¼€æº** | âœ… Fair-code | âŒ é—­æº |
| **è‡ªæ‰˜ç®¡** | âœ… å®Œå…¨æ”¯æŒ | âŒ ä»…äº‘ç«¯ |
| **ä»£ç èŠ‚ç‚¹** | âœ… JS + Python | âš ï¸ JS æœ‰é™ |
| **å¯è§†åŒ–** | âœ… æµç¨‹å›¾ | âœ… æµç¨‹å›¾ï¼ˆæ›´å¤æ‚ï¼‰ |
| **å®šä»·** | ğŸ’° å…è´¹ï¼ˆè‡ªæ‰˜ç®¡ï¼‰ | ğŸ’°ğŸ’° æŒ‰æ“ä½œè®¡è´¹ |
| **AI é›†æˆ** | âœ… LangChain æ·±åº¦ | âš ï¸ åŸºç¡€ AI |
| **ç¤¾åŒº** | âœ… æ´»è·ƒå¼€æºç¤¾åŒº | âš ï¸ å®˜æ–¹æ”¯æŒ |

**ç»“è®º**ï¼š
- å¼€æºéœ€æ±‚ â†’ **n8n**
- å¤æ‚å¯è§†åŒ–æµç¨‹ â†’ Make ç¨å¥½
- æˆæœ¬æ§åˆ¶ â†’ **n8n** è‡ªæ‰˜ç®¡

### 2.2 n8n çš„æ ¸å¿ƒä¼˜åŠ¿

#### ä¼˜åŠ¿ 1: æ•°æ®ä¸»æƒ

```
ä¼ ç»Ÿäº‘ç«¯è‡ªåŠ¨åŒ–å¹³å°ï¼š
ä½ çš„æ•°æ® â†’ ç»è¿‡ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ â†’ åˆ°è¾¾ç›®æ ‡
           â†“
       å®‰å…¨é£é™©ã€éšç§é—®é¢˜ã€åˆè§„å›°éš¾

n8n è‡ªæ‰˜ç®¡ï¼š
ä½ çš„æ•°æ® â†’ ä½ çš„æœåŠ¡å™¨ â†’ ç›®æ ‡
           â†“
       å®Œå…¨æŒæ§ã€ç¬¦åˆ GDPRã€å¯å†…ç½‘éƒ¨ç½²
```

#### ä¼˜åŠ¿ 2: æ— é™æ‰§è¡Œï¼ˆè‡ªæ‰˜ç®¡æ¨¡å¼ï¼‰

```
Zapier å®šä»·ï¼š
â”œâ”€ Freeï¼š100 æ¬¡/æœˆ
â”œâ”€ Proï¼š$20/æœˆ â†’ 10,000 æ¬¡
â”œâ”€ Teamï¼š$50/æœˆ â†’ 50,000 æ¬¡
â””â”€ Companyï¼š$300/æœˆ â†’ 100,000 æ¬¡

n8n è‡ªæ‰˜ç®¡ï¼š
â”œâ”€ è½¯ä»¶è´¹ï¼š$0
â”œâ”€ æ‰§è¡Œæ¬¡æ•°ï¼šæ— é™
â”œâ”€ æˆæœ¬ï¼šåªæœ‰æœåŠ¡å™¨è´¹ç”¨ï¼ˆ$5-20/æœˆï¼‰
â””â”€ ROIï¼šç¬¬ 1 ä¸ªæœˆå°±å›æœ¬
```

**å®é™…æ¡ˆä¾‹**ï¼š

```
åœºæ™¯ï¼šæ¯å¤©å¤„ç† 10,000 ä¸ªäº¤æ˜“ä¿¡å·
Zapier æˆæœ¬ï¼š$300/æœˆï¼ˆ100,000 æ¬¡ï¼‰
n8n æˆæœ¬ï¼š$10/æœˆï¼ˆDigitalOcean Dropletï¼‰
å¹´åº¦èŠ‚çœï¼š$3,480
```

#### ä¼˜åŠ¿ 3: ä»£ç çµæ´»æ€§

```javascript
// n8n Code Node ç¤ºä¾‹
// å¤æ‚æ•°æ®è½¬æ¢
const items = $input.all();

return items.map(item => {
  // ä»»æ„ JavaScript ä»£ç 
  const sentiment = analyzeSentiment(item.json.text);
  const category = classifyContent(item.json.content);

  return {
    json: {
      ...item.json,
      sentiment,
      category,
      processedAt: new Date().toISOString()
    }
  };
});
```

**vs Zapier çš„ Code èŠ‚ç‚¹**ï¼š
- âŒ æ—¶é—´é™åˆ¶ï¼š1 ç§’
- âŒ åŠŸèƒ½å—é™ï¼šæ— æ³•å¯¼å…¥ npm åŒ…
- âŒ è°ƒè¯•å›°éš¾ï¼šæ— æ—¥å¿—

**n8n**ï¼š
- âœ… æ—¶é—´å……è¶³ï¼šé»˜è®¤ 120 ç§’
- âœ… å®Œæ•´ Node.jsï¼šå¯å¯¼å…¥ä»»ä½• npm åŒ…
- âœ… å®Œå–„è°ƒè¯•ï¼šè¯¦ç»†æ—¥å¿— + æ•°æ®é¢„è§ˆ

#### ä¼˜åŠ¿ 4: AI åŸç”Ÿé›†æˆ

```
n8n AI èƒ½åŠ›ï¼š
â”œâ”€ LangChain é›†æˆï¼ˆ70+ AI èŠ‚ç‚¹ï¼‰
â”œâ”€ OpenAIã€Anthropicã€Gemini åŸç”Ÿæ”¯æŒ
â”œâ”€ å‘é‡æ•°æ®åº“ï¼ˆPineconeã€Weaviateã€Qdrantï¼‰
â”œâ”€ åµŒå…¥æ¨¡å‹ï¼ˆEmbeddingsï¼‰
â”œâ”€ RAG å·¥ä½œæµ
â”œâ”€ AI Agent ç¼–æ’
â””â”€ è®°å¿†ç³»ç»Ÿ

å¯ä»¥å®ç°ï¼š
â”œâ”€ æ™ºèƒ½å®¢æœ
â”œâ”€ æ–‡æ¡£åˆ†æ
â”œâ”€ å†…å®¹ç”Ÿæˆ
â”œâ”€ æ•°æ®æå–
â””â”€ å†³ç­–è¾…åŠ©
```

### 2.3 è°åº”è¯¥ä½¿ç”¨ n8nï¼Ÿ

#### âœ… å®Œç¾é€‚åˆ

1. **æŠ€æœ¯å›¢é˜Ÿ/å¼€å‘è€…**
   - éœ€è¦ä»£ç çµæ´»æ€§
   - æƒ³è¦æ•°æ®ä¸»æƒ
   - é«˜é¢‘æ‰§è¡Œä»»åŠ¡

2. **åˆ›ä¸šå…¬å¸/ä¸ªäººå¼€å‘è€…**
   - é¢„ç®—æœ‰é™
   - éœ€è¦å¿«é€Ÿè¿­ä»£
   - ä¸€äººèº«å…¼å¤šèŒ

3. **æ•°æ®æ•æ„Ÿå‹ä¼ä¸š**
   - åŒ»ç–—ã€é‡‘èã€æ³•å¾‹
   - GDPR/HIPAA åˆè§„è¦æ±‚
   - å†…ç½‘éƒ¨ç½²éœ€æ±‚

4. **AI/ML å›¢é˜Ÿ**
   - éœ€è¦ AI å·¥ä½œæµç¼–æ’
   - å‘é‡æ•°æ®åº“é›†æˆ
   - æ¨¡å‹è°ƒç”¨è‡ªåŠ¨åŒ–

#### âš ï¸ å¯èƒ½ä¸é€‚åˆ

1. **å®Œå…¨éæŠ€æœ¯ç”¨æˆ·**
   - å»ºè®®ï¼šZapier æˆ– Make

2. **éœ€è¦æµ·é‡é›†æˆ**
   - n8nï¼š400+
   - Zapierï¼š7,000+
   - å»ºè®®ï¼šæ··åˆä½¿ç”¨

3. **æç®€åœºæ™¯**
   - IFTTT å¯èƒ½æ›´ç®€å•

---

## 3. æ ¸å¿ƒæ¶æ„åŸç†

### 3.1 æŠ€æœ¯æ ˆ

```
å‰ç«¯ï¼ˆ7.8%ï¼‰
â”œâ”€ Vue.js 3
â”œâ”€ TypeScript
â”œâ”€ Vite
â””â”€ Element Plus

åç«¯ï¼ˆ90.6%ï¼‰
â”œâ”€ Node.js 18+
â”œâ”€ TypeScript
â”œâ”€ Express.js
â”œâ”€ SQLite/PostgreSQL/MySQL
â””â”€ Redisï¼ˆå¯é€‰ï¼‰

åŸºç¡€è®¾æ–½
â”œâ”€ Docker
â”œâ”€ Docker Compose
â”œâ”€ Kubernetesï¼ˆå¯é€‰ï¼‰
â””â”€ GitHub Actionsï¼ˆCI/CDï¼‰
```

### 3.2 æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç”¨æˆ·ç•Œé¢                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ç¼–è¾‘å™¨ (Vue) â”‚    â”‚ æ‰§è¡Œè§†å›¾      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†• WebSocket / REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               n8n Server (Node.js)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ API Layer   â”‚  â”‚ Workflow    â”‚               â”‚
â”‚  â”‚             â”‚  â”‚ Engine      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚    Node Execution Manager        â”‚           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”   â”‚           â”‚
â”‚  â”‚  â”‚Nodeâ”‚ â”‚Nodeâ”‚ â”‚Nodeâ”‚ â”‚Nodeâ”‚   â”‚           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database (SQLite/PG)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Workflows    â”‚  â”‚ Executions   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Credentials  â”‚  â”‚ Settings     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å·¥ä½œæµæ‰§è¡Œæµç¨‹

```
1. è§¦å‘é˜¶æ®µ
   ç”¨æˆ·/Webhook/å®šæ—¶å™¨ â†’ è§¦å‘å·¥ä½œæµ
                â†“
   Workflow Engine æ¥æ”¶è§¦å‘äº‹ä»¶
                â†“
   åˆ›å»º Execution è®°å½•

2. æ‰§è¡Œé˜¶æ®µ
   åŠ è½½å·¥ä½œæµå®šä¹‰
                â†“
   æŒ‰æ‹“æ‰‘é¡ºåºæ‰§è¡ŒèŠ‚ç‚¹
   Node 1 â†’ Node 2 â†’ Node 3
     â†“       â†“        â†“
   æ‰§è¡ŒæˆåŠŸï¼Ÿ  æ˜¯ â†’ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
     â†“       å¦ â†’ é”™è¯¯å¤„ç†
   è®°å½•è¾“å‡ºæ•°æ®

3. å®Œæˆé˜¶æ®µ
   æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ
                â†“
   æ›´æ–° Execution çŠ¶æ€
                â†“
   å­˜å‚¨æ‰§è¡Œç»“æœ
                â†“
   è§¦å‘ Webhookï¼ˆå¦‚æœæœ‰ï¼‰
```

### 3.4 æ•°æ®æµè½¬

```javascript
// èŠ‚ç‚¹é—´æ•°æ®ä¼ é€’
{
  "json": {
    // å®é™…æ•°æ®
    "id": 123,
    "name": "John Doe",
    "email": "john@example.com"
  },
  "binary": {
    // äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚æ–‡ä»¶ï¼‰
    "file": {
      "data": "base64_encoded_data",
      "mimeType": "application/pdf",
      "fileName": "document.pdf"
    }
  },
  "pairedItem": {
    // è¿½æº¯æ•°æ®æ¥æº
    "item": 0,
    "input": 0
  }
}
```

**æ•°æ®è½¬æ¢ç¤ºä¾‹**ï¼š

```
Node 1 (HTTP Request)
è¾“å‡º: [
  { json: { userId: 1, name: "Alice" } },
  { json: { userId: 2, name: "Bob" } }
]
        â†“
Node 2 (Code - Transform)
ä»£ç : items.map(item => ({
  json: {
    id: item.json.userId,
    fullName: item.json.name.toUpperCase()
  }
}))
è¾“å‡º: [
  { json: { id: 1, fullName: "ALICE" } },
  { json: { id: 2, fullName: "BOB" } }
]
        â†“
Node 3 (Database - Insert)
æ’å…¥æ•°æ®åº“
```

---

## 4. èŠ‚ç‚¹ç³»ç»Ÿè¯¦è§£

### 4.1 èŠ‚ç‚¹åˆ†ç±»

#### Core Nodesï¼ˆæ ¸å¿ƒèŠ‚ç‚¹ï¼‰

```
æ•°æ®æ“ä½œ
â”œâ”€ Codeï¼ˆä»£ç èŠ‚ç‚¹ï¼‰ï¼šJS/Python
â”œâ”€ Functionï¼ˆå‡½æ•°èŠ‚ç‚¹ï¼‰ï¼šè½»é‡çº§ JS
â”œâ”€ Setï¼ˆè®¾ç½®èŠ‚ç‚¹ï¼‰ï¼šæ·»åŠ /ä¿®æ”¹å­—æ®µ
â”œâ”€ Mergeï¼ˆåˆå¹¶èŠ‚ç‚¹ï¼‰ï¼šåˆå¹¶å¤šä¸ªè¾“å…¥
â”œâ”€ Split In Batchesï¼ˆæ‰¹å¤„ç†ï¼‰ï¼šåˆ†æ‰¹å¤„ç†
â””â”€ Item Listsï¼ˆåˆ—è¡¨æ“ä½œï¼‰ï¼šè¿‡æ»¤/æ’åº/å»é‡

HTTP/API
â”œâ”€ HTTP Requestï¼šé€šç”¨ HTTP è¯·æ±‚
â”œâ”€ Webhookï¼šæ¥æ”¶ HTTP å›è°ƒ
â””â”€ SSE Triggerï¼šServer-Sent Events

æ•°æ®åº“
â”œâ”€ Postgresã€MySQLã€MongoDB
â”œâ”€ Redisã€Supabase
â””â”€ SQLiteï¼ˆå†…ç½®ï¼‰

æµç¨‹æ§åˆ¶
â”œâ”€ IFï¼šæ¡ä»¶åˆ†æ”¯
â”œâ”€ Switchï¼šå¤šåˆ†æ”¯é€‰æ‹©
â”œâ”€ Mergeï¼šåˆå¹¶åˆ†æ”¯
â””â”€ Loop Over Itemsï¼šå¾ªç¯å¤„ç†
```

#### Integration Nodesï¼ˆé›†æˆèŠ‚ç‚¹ï¼‰

```
ç”Ÿäº§åŠ›å·¥å…·
â”œâ”€ Gmailã€Outlookï¼šé‚®ä»¶
â”œâ”€ Google Driveã€Dropboxï¼šæ–‡ä»¶å­˜å‚¨
â”œâ”€ Notionã€Airtableï¼šæ•°æ®åº“
â””â”€ Slackã€Discordï¼šé€šè®¯

å¼€å‘å·¥å…·
â”œâ”€ GitHubã€GitLabï¼šç‰ˆæœ¬æ§åˆ¶
â”œâ”€ Dockerã€Kubernetesï¼šå®¹å™¨
â”œâ”€ AWSã€GCPã€Azureï¼šäº‘æœåŠ¡
â””â”€ Jenkinsã€CircleCIï¼šCI/CD

è¥é”€å·¥å…·
â”œâ”€ HubSpotã€Salesforceï¼šCRM
â”œâ”€ Mailchimpã€SendGridï¼šé‚®ä»¶è¥é”€
â”œâ”€ Google Analyticsï¼šåˆ†æ
â””â”€ Facebookã€Twitterï¼šç¤¾äº¤åª’ä½“

AI/ML
â”œâ”€ OpenAIï¼ˆGPT-4ã€DALL-Eï¼‰
â”œâ”€ Anthropicï¼ˆClaudeï¼‰
â”œâ”€ Googleï¼ˆGeminiï¼‰
â”œâ”€ Pineconeã€Weaviateï¼šå‘é‡æ•°æ®åº“
â””â”€ LangChainï¼šAI å·¥ä½œæµ

åŠ å¯†è´§å¸
â”œâ”€ Coinbaseã€Binanceï¼šäº¤æ˜“æ‰€
â”œâ”€ CoinGeckoã€CoinMarketCapï¼šæ•°æ®
â””â”€ Ethereumã€Bitcoinï¼šåŒºå—é“¾
```

### 4.2 èŠ‚ç‚¹å·¥ä½œåŸç†

#### èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ

```javascript
// ç®€åŒ–çš„èŠ‚ç‚¹æ‰§è¡Œæµç¨‹
class CustomNode {
  async execute(context) {
    // 1. è·å–è¾“å…¥æ•°æ®
    const items = context.getInputData();

    // 2. è·å–èŠ‚ç‚¹å‚æ•°
    const apiKey = context.getNodeParameter('apiKey');
    const endpoint = context.getNodeParameter('endpoint');

    // 3. æ‰§è¡Œæ“ä½œ
    const results = [];
    for (const item of items) {
      try {
        const response = await axios.post(endpoint, item.json, {
          headers: { 'Authorization': `Bearer ${apiKey}` }
        });
        results.push({ json: response.data });
      } catch (error) {
        // 4. é”™è¯¯å¤„ç†
        if (context.continueOnFail()) {
          results.push({ json: { error: error.message } });
        } else {
          throw error;
        }
      }
    }

    // 5. è¿”å›è¾“å‡º
    return [results];
  }
}
```

#### èŠ‚ç‚¹é…ç½®ç¤ºä¾‹

```typescript
// HTTP Request èŠ‚ç‚¹é…ç½®
{
  "parameters": {
    "method": "POST",
    "url": "https://api.example.com/data",
    "authentication": "predefinedCredentialType",
    "nodeCredentialType": "httpHeaderAuth",
    "sendHeaders": true,
    "headerParameters": {
      "parameter": [
        {
          "name": "Content-Type",
          "value": "application/json"
        }
      ]
    },
    "sendBody": true,
    "bodyParameters": {
      "parameter": [
        {
          "name": "userId",
          "value": "={{ $json.id }}"  // è¡¨è¾¾å¼å¼•ç”¨
        }
      ]
    }
  }
}
```

### 4.3 è¡¨è¾¾å¼ç³»ç»Ÿ

n8n ä½¿ç”¨åŒèŠ±æ‹¬å· `{{ }}` æ¥å¼•ç”¨æ•°æ®å’Œæ‰§è¡Œè¡¨è¾¾å¼ï¼š

```javascript
// åŸºç¡€å¼•ç”¨
{{ $json.fieldName }}              // å½“å‰èŠ‚ç‚¹çš„ JSON æ•°æ®
{{ $node['èŠ‚ç‚¹å'].json.field }}   // å…¶ä»–èŠ‚ç‚¹çš„æ•°æ®
{{ $parameters.paramName }}        // èŠ‚ç‚¹å‚æ•°

// å†…ç½®å˜é‡
{{ $now }}                         // å½“å‰æ—¶é—´æˆ³
{{ $today }}                       // ä»Šå¤©æ—¥æœŸ
{{ $execution.id }}                // æ‰§è¡Œ ID
{{ $workflow.id }}                 // å·¥ä½œæµ ID

// JavaScript è¡¨è¾¾å¼
{{ $json.price * 1.1 }}                    // è®¡ç®—
{{ $json.name.toUpperCase() }}             // å­—ç¬¦ä¸²æ“ä½œ
{{ $json.items.map(i => i.price) }}        // æ•°ç»„æ“ä½œ
{{ $json.age >= 18 ? 'Adult' : 'Minor' }}  // æ¡ä»¶

// æ—¥æœŸå¤„ç†
{{ $now.plus(7, 'days').format('yyyy-MM-dd') }}
{{ DateTime.fromISO($json.date).diff(DateTime.now(), 'days') }}

// JSON è·¯å¾„
{{ $json['user.name'] }}           // å¸¦ç‰¹æ®Šå­—ç¬¦çš„å­—æ®µ
{{ $json.items[0].price }}         // æ•°ç»„ç´¢å¼•
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š

```javascript
// åœºæ™¯ï¼šæ ¹æ®è®¢å•é‡‘é¢è®¡ç®—æŠ˜æ‰£
{
  "discountAmount": "={{ $json.totalAmount >= 1000 ? $json.totalAmount * 0.1 : 0 }}",
  "finalPrice": "={{ $json.totalAmount - $json.discountAmount }}",
  "message": "={{ $json.discountAmount > 0 ? 'Congratulations! You saved $' + $json.discountAmount : 'No discount applied' }}"
}
```

---

## 5. å·¥ä½œæµè®¾è®¡

### 5.1 å·¥ä½œæµæ¨¡å¼

#### æ¨¡å¼ 1: çº¿æ€§æµç¨‹

```
æœ€ç®€å•çš„æ¨¡å¼ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œ

[Trigger] â†’ [Node 1] â†’ [Node 2] â†’ [Node 3] â†’ [End]

ç¤ºä¾‹ï¼š
æ–°é‚®ä»¶ â†’ æå–é™„ä»¶ â†’ ä¸Šä¼ åˆ° Google Drive â†’ å‘é€ç¡®è®¤
```

#### æ¨¡å¼ 2: æ¡ä»¶åˆ†æ”¯

```
åŸºäºæ¡ä»¶é€‰æ‹©ä¸åŒè·¯å¾„

         â”Œâ”€ [Yes] â†’ [Action A]
[IF] â”€â”€â”€â”€â”¤
         â””â”€ [No]  â†’ [Action B]

ç¤ºä¾‹ï¼š
è®¢å• â†’ æ£€æŸ¥é‡‘é¢
         â”œâ”€ >$1000 â†’ å®¡æ‰¹æµç¨‹
         â””â”€ <$1000 â†’ ç›´æ¥å¤„ç†
```

#### æ¨¡å¼ 3: å¹¶è¡Œæ‰§è¡Œ

```
åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œç„¶ååˆå¹¶

       â”Œâ”€ [Task A] â”€â”
[Split]â”¼â”€ [Task B] â”€â”¼ [Merge]
       â””â”€ [Task C] â”€â”˜

ç¤ºä¾‹ï¼š
æ–°ç”¨æˆ·
  â”œâ”€ å‘é€æ¬¢è¿é‚®ä»¶
  â”œâ”€ åˆ›å»º CRM è®°å½•
  â””â”€ é€šçŸ¥é”€å”®å›¢é˜Ÿ
      â†“
  åˆå¹¶ç»“æœ
```

#### æ¨¡å¼ 4: å¾ªç¯å¤„ç†

```
å¯¹æ¯ä¸ªé¡¹ç›®æ‰§è¡Œç›¸åŒæ“ä½œ

[Get Items] â†’ [Loop] â†’ [Process] â†’ [Next Item]
                 â†“
              [All Done]

ç¤ºä¾‹ï¼š
è·å– 100 ä¸ªå®¢æˆ·
  â†“
å¾ªç¯æ¯ä¸ªå®¢æˆ·
  â”œâ”€ æŸ¥è¯¢è®¢å•
  â”œâ”€ è®¡ç®—æ€»æ¶ˆè´¹
  â””â”€ æ›´æ–°ç­‰çº§
```

#### æ¨¡å¼ 5: é”™è¯¯å¤„ç†

```
æ•è·å¹¶å¤„ç†é”™è¯¯

[Node] â”€â”€Errorâ†’ [Error Trigger] â†’ [Handle Error]
   â†“
[Success]

ç¤ºä¾‹ï¼š
API è°ƒç”¨
  â”œâ”€ æˆåŠŸ â†’ å¤„ç†æ•°æ®
  â””â”€ å¤±è´¥ â†’ è®°å½•é”™è¯¯ â†’ å‘é€é€šçŸ¥ â†’ é‡è¯•
```

### 5.2 æœ€ä½³å®è·µ

#### 1. æ¨¡å—åŒ–è®¾è®¡

```
âŒ ä¸å¥½ï¼šæ‰€æœ‰é€»è¾‘éƒ½åœ¨ä¸€ä¸ªå·¥ä½œæµä¸­

âœ… å¥½ï¼šæ‹†åˆ†æˆå¤šä¸ªå­å·¥ä½œæµ

Main Workflow:
  â”œâ”€ [Trigger]
  â”œâ”€ [Execute Workflow: Data Validation]
  â”œâ”€ [Execute Workflow: Process Data]
  â””â”€ [Execute Workflow: Send Notifications]

ä¼˜åŠ¿ï¼š
- å¯å¤ç”¨
- æ˜“æµ‹è¯•
- æ˜“ç»´æŠ¤
```

#### 2. é”™è¯¯å¤„ç†

```javascript
// åœ¨ Code èŠ‚ç‚¹ä¸­
try {
  const result = await riskyOperation();
  return [{ json: result }];
} catch (error) {
  // è®°å½•è¯¦ç»†é”™è¯¯
  console.error('Operation failed:', {
    message: error.message,
    stack: error.stack,
    input: $input.all()
  });

  // è¿”å›é”™è¯¯ä¿¡æ¯
  return [{ json: { error: error.message, failedAt: new Date() } }];
}
```

#### 3. æ•°æ®éªŒè¯

```javascript
// åœ¨å¤„ç†å‰éªŒè¯æ•°æ®
const items = $input.all();

// æ£€æŸ¥å¿…éœ€å­—æ®µ
const validated = items.filter(item => {
  const required = ['email', 'name', 'phone'];
  return required.every(field => item.json[field]);
});

// è®°å½•æ— æ•ˆæ•°æ®
const invalid = items.filter(item => !validated.includes(item));
if (invalid.length > 0) {
  console.warn('Invalid items:', invalid);
}

return validated;
```

#### 4. æ€§èƒ½ä¼˜åŒ–

```javascript
// âŒ ä¸å¥½ï¼šé€ä¸ªå¤„ç†ï¼ˆæ…¢ï¼‰
for (const item of items) {
  await apiCall(item);
}

// âœ… å¥½ï¼šæ‰¹é‡å¤„ç†ï¼ˆå¿«ï¼‰
const batchSize = 100;
for (let i = 0; i < items.length; i += batchSize) {
  const batch = items.slice(i, i + batchSize);
  await apiBatchCall(batch);
}

// âœ… æ›´å¥½ï¼šå¹¶å‘å¤„ç†ï¼ˆæœ€å¿«ï¼‰
const promises = items.map(item => apiCall(item));
const results = await Promise.all(promises);
```

### 5.3 è°ƒè¯•æŠ€å·§

#### 1. æ•°æ®æ£€æŸ¥èŠ‚ç‚¹

```
åœ¨å…³é”®ä½ç½®æ’å…¥ Code èŠ‚ç‚¹ï¼š

console.log('Current data:', JSON.stringify($input.all(), null, 2));
console.log('Node parameters:', $parameters);
console.log('Workflow variables:', $vars);

return $input.all(); // é€ä¼ æ•°æ®
```

#### 2. ä½¿ç”¨ Sticky Notes

```
åœ¨ç¼–è¾‘å™¨ä¸­æ·»åŠ æ³¨é‡Šï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ é‡è¦æç¤º         â”‚
â”‚  è¿™ä¸ªèŠ‚ç‚¹å¤„ç†ä»˜æ¬¾    â”‚
â”‚  å¤±è´¥æ—¶ä¼šé‡è¯• 3 æ¬¡   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. Pin Dataï¼ˆå›ºå®šæ•°æ®ï¼‰

```
åœ¨æµ‹è¯•æ—¶å›ºå®šè¾“å…¥æ•°æ®ï¼š

å³é”®èŠ‚ç‚¹ â†’ Pin Data â†’ è¾“å…¥æµ‹è¯•æ•°æ®

å¥½å¤„ï¼š
- æ— éœ€æ¯æ¬¡éƒ½è§¦å‘ä¸Šæ¸¸èŠ‚ç‚¹
- å¯ä»¥æµ‹è¯•è¾¹ç¼˜æƒ…å†µ
- åŠ é€Ÿå¼€å‘è¿­ä»£
```

---

## 6. ä»£ç èƒ½åŠ›

### 6.1 Code èŠ‚ç‚¹è¯¦è§£

#### JavaScript èŠ‚ç‚¹

```javascript
// å®Œæ•´çš„ Node.js ç¯å¢ƒ
// å¯ä»¥ä½¿ç”¨æ‰€æœ‰å†…ç½®æ¨¡å—

// 1. åŸºç¡€æ•°æ®å¤„ç†
const items = $input.all();

const processed = items.map(item => {
  return {
    json: {
      // æ•°æ®è½¬æ¢
      userId: item.json.id,
      fullName: `${item.json.firstName} ${item.json.lastName}`,
      // è®¡ç®—å­—æ®µ
      age: new Date().getFullYear() - new Date(item.json.birthDate).getFullYear(),
      // æ¡ä»¶é€»è¾‘
      status: item.json.isActive ? 'active' : 'inactive'
    }
  };
});

return processed;
```

```javascript
// 2. å¤–éƒ¨ API è°ƒç”¨
const axios = require('axios');

const results = [];

for (const item of $input.all()) {
  const response = await axios.get(`https://api.example.com/user/${item.json.userId}`, {
    headers: {
      'Authorization': `Bearer ${$credentials.apiKey}`
    }
  });

  results.push({
    json: {
      ...item.json,
      apiData: response.data
    }
  });
}

return results;
```

```javascript
// 3. å¤æ‚æ•°æ®è½¬æ¢
const _ = require('lodash');

const items = $input.all();

// åˆ†ç»„
const grouped = _.groupBy(items, item => item.json.category);

// èšåˆ
const aggregated = Object.entries(grouped).map(([category, items]) => ({
  json: {
    category,
    count: items.length,
    totalAmount: _.sumBy(items, i => i.json.amount),
    avgAmount: _.meanBy(items, i => i.json.amount)
  }
}));

return aggregated;
```

#### Python èŠ‚ç‚¹ï¼ˆBetaï¼‰

```python
# n8n ç°åœ¨æ”¯æŒ Pythonï¼

# 1. æ•°æ®å¤„ç†
import pandas as pd

# è½¬æ¢ä¸º DataFrame
data = [item['json'] for item in _input.all()]
df = pd.DataFrame(data)

# Pandas æ“ä½œ
df['total'] = df['price'] * df['quantity']
df['discount'] = df['total'] * 0.1

# è½¬å› n8n æ ¼å¼
return [{'json': row.to_dict()} for _, row in df.iterrows()]
```

```python
# 2. æœºå™¨å­¦ä¹ 
from sklearn.linear_model import LinearRegression
import numpy as np

# è·å–è®­ç»ƒæ•°æ®
items = _input.all()
X = np.array([[i['json']['feature1'], i['json']['feature2']] for i in items])
y = np.array([i['json']['target'] for i in items])

# è®­ç»ƒæ¨¡å‹
model = LinearRegression()
model.fit(X, y)

# é¢„æµ‹
predictions = model.predict(X)

# è¿”å›ç»“æœ
return [{'json': {'prediction': float(p)}} for p in predictions]
```

### 6.2 å¯ç”¨çš„ npm åŒ…

```javascript
// å¸¸ç”¨åº“ï¼ˆå·²é¢„è£…ï¼‰
const axios = require('axios');       // HTTP è¯·æ±‚
const lodash = require('lodash');     // å®ç”¨å·¥å…·
const moment = require('moment');     // æ—¥æœŸå¤„ç†
const cheerio = require('cheerio');   // HTML è§£æ

// æ•°æ®å¤„ç†
const Papa = require('papaparse');    // CSV è§£æ
const xml2js = require('xml2js');     // XML è§£æ

// åŠ å¯†
const crypto = require('crypto');     // åŠ å¯†/å“ˆå¸Œ
const bcrypt = require('bcrypt');     // å¯†ç å“ˆå¸Œ

// æ–‡ä»¶å¤„ç†
const fs = require('fs');             // æ–‡ä»¶ç³»ç»Ÿ
const path = require('path');         // è·¯å¾„å¤„ç†

// è‡ªå®šä¹‰å¯¼å…¥ï¼ˆéœ€è¦é…ç½®ï¼‰
// åœ¨ n8n è®¾ç½®ä¸­å¯ç”¨ npm åŒ…å®‰è£…
const customLib = require('your-custom-library');
```

### 6.3 é«˜çº§æŠ€å·§

#### 1. è®¿é—®ç¯å¢ƒå˜é‡

```javascript
// è¯»å–ç¯å¢ƒå˜é‡
const apiKey = $env.MY_API_KEY;
const dbUrl = $env.DATABASE_URL;

// å®‰å…¨å®è·µï¼šæ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡è€Œéä»£ç 
```

#### 2. ä½¿ç”¨å‡­è¯

```javascript
// è®¿é—®å­˜å‚¨çš„å‡­è¯
const credentials = await $getCredentials('openaiApi');

const response = await axios.post('https://api.openai.com/v1/chat/completions', {
  model: 'gpt-4',
  messages: [...]
}, {
  headers: {
    'Authorization': `Bearer ${credentials.apiKey}`
  }
});
```

#### 3. å·¥ä½œæµå˜é‡

```javascript
// è®¾ç½®å·¥ä½œæµå˜é‡ï¼ˆè·¨èŠ‚ç‚¹å…±äº«ï¼‰
$vars.userCount = items.length;
$vars.processedAt = new Date().toISOString();

// åœ¨åç»­èŠ‚ç‚¹ä¸­è®¿é—®
const count = $vars.userCount;
```

#### 4. äºŒè¿›åˆ¶æ•°æ®å¤„ç†

```javascript
// å¤„ç†æ–‡ä»¶
const items = $input.all();

for (const item of items) {
  if (item.binary.file) {
    const buffer = Buffer.from(item.binary.file.data, 'base64');

    // å¤„ç†æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šè°ƒæ•´å›¾ç‰‡å¤§å°ï¼‰
    const sharp = require('sharp');
    const resized = await sharp(buffer)
      .resize(800, 600)
      .toBuffer();

    item.binary.file.data = resized.toString('base64');
  }
}

return items;
```

---

## 7. AI é›†æˆ

### 7.1 LangChain é›†æˆ

n8n æ˜¯å”¯ä¸€åŸç”Ÿé›†æˆ LangChain çš„å·¥ä½œæµå¹³å°ã€‚

#### AI Agent æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LangChain Agent              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LLM (GPT-4/Claude/Gemini)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Memory (Conversation Buffer)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â†“                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Tools                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ Web Search                â”‚  â”‚
â”‚  â”‚  â”œâ”€ Calculator                â”‚  â”‚
â”‚  â”‚  â”œâ”€ Database Query            â”‚  â”‚
â”‚  â”‚  â””â”€ Custom API                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åŸºç¡€ AI å·¥ä½œæµ

```
ç¤ºä¾‹ï¼šæ™ºèƒ½æ–‡æ¡£é—®ç­”

[ç”¨æˆ·æé—®]
    â†“
[Load Document] â†’ åˆ‡åˆ†æ–‡æœ¬
    â†“
[Generate Embeddings] â†’ å‘é‡åŒ–
    â†“
[Store in Vector DB] â†’ Pinecone/Weaviate
    â†“
[Retrieve Relevant Chunks] â†’ è¯­ä¹‰æœç´¢
    â†“
[LLM with Context] â†’ GPT-4 å›ç­”
    â†“
[è¿”å›ç­”æ¡ˆ]
```

### 7.2 å¸¸ç”¨ AI èŠ‚ç‚¹

#### OpenAI èŠ‚ç‚¹

```javascript
// Chat æ¨¡å¼
{
  "model": "gpt-4",
  "messages": [
    {
      "role": "system",
      "content": "You are a helpful assistant for a trading platform."
    },
    {
      "role": "user",
      "content": "={{ $json.userQuestion }}"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 500
}
```

#### Embeddings èŠ‚ç‚¹

```javascript
// ç”Ÿæˆæ–‡æœ¬åµŒå…¥å‘é‡
{
  "model": "text-embedding-3-small",
  "input": "={{ $json.documentContent }}"
}

// è¾“å‡ºï¼š1536 ç»´å‘é‡
```

#### Vector Store èŠ‚ç‚¹

```javascript
// Pinecone æ’å…¥
{
  "operation": "insert",
  "index": "knowledge-base",
  "vectors": [
    {
      "id": "={{ $json.id }}",
      "values": "={{ $json.embedding }}",
      "metadata": {
        "text": "={{ $json.originalText }}",
        "source": "={{ $json.source }}"
      }
    }
  ]
}

// Pinecone æŸ¥è¯¢
{
  "operation": "query",
  "index": "knowledge-base",
  "vector": "={{ $json.queryEmbedding }}",
  "topK": 5
}
```

### 7.3 å®æˆ˜ AI å·¥ä½œæµ

#### å·¥ä½œæµ 1: RAG ç³»ç»Ÿ

```
ç”¨æˆ·é—®é¢˜ï¼š"ä»€ä¹ˆæ˜¯ n8nï¼Ÿ"
    â†“
[Embeddings] â†’ é—®é¢˜å‘é‡åŒ–
    â†“
[Pinecone Query] â†’ æ£€ç´¢ç›¸å…³æ–‡æ¡£
    â†“
[Aggregate Context] â†’ åˆå¹¶ä¸Šä¸‹æ–‡
    â†“
[OpenAI Chat] â†’ åŸºäºä¸Šä¸‹æ–‡å›ç­”
    prompt: "æ ¹æ®ä»¥ä¸‹ä¿¡æ¯å›ç­”é—®é¢˜ï¼š
             ä¸Šä¸‹æ–‡ï¼š{{ $json.retrievedDocs }}
             é—®é¢˜ï¼š{{ $json.userQuestion }}"
    â†“
è¿”å›ç­”æ¡ˆ
```

#### å·¥ä½œæµ 2: å†…å®¹ç”Ÿæˆç®¡é“

```
è¾“å…¥ä¸»é¢˜ï¼š"AI in Trading"
    â†“
[GPT-4: å¤§çº²ç”Ÿæˆ]
    â†“
[Loop: æ¯ä¸ªç« èŠ‚]
    â”œâ”€ [GPT-4: ç« èŠ‚å†…å®¹]
    â”œâ”€ [GPT-4: ç›¸å…³æ¡ˆä¾‹]
    â””â”€ [DALL-E: é…å›¾ç”Ÿæˆ]
    â†“
[Merge: åˆå¹¶ç« èŠ‚]
    â†“
[Format to Markdown]
    â†“
[Publish to Blog]
```

#### å·¥ä½œæµ 3: AI å®¢æœ

```
[Webhook: æ¥æ”¶æ¶ˆæ¯]
    â†“
[Load Conversation History] â†’ ä»æ•°æ®åº“
    â†“
[OpenAI Chat]
    messages: [
      ...historyMessages,
      { role: "user", content: newMessage }
    ]
    â†“
[Branch: éœ€è¦äººå·¥ä»‹å…¥ï¼Ÿ]
    â”œâ”€ Yes â†’ [é€šçŸ¥äººå·¥å®¢æœ]
    â””â”€ No  â†’ [è‡ªåŠ¨å›å¤]
    â†“
[Save to History]
```

### 7.4 AI æœ€ä½³å®è·µ

#### 1. Prompt Engineering

```javascript
// âŒ ä¸å¥½ï¼šæ¨¡ç³Šçš„ prompt
"Write about trading"

// âœ… å¥½ï¼šå…·ä½“çš„ prompt
`You are an expert financial analyst with 10 years of experience in algorithmic trading.

Task: Analyze the following trading data and provide:
1. A summary of key trends
2. Potential trading opportunities
3. Risk factors to consider

Data:
${JSON.stringify($json.tradingData, null, 2)}

Format your response in markdown with clear sections.`
```

#### 2. æˆæœ¬æ§åˆ¶

```javascript
// Token è®¡æ•°
const estimateTokens = (text) => {
  // ç²—ç•¥ä¼°è®¡ï¼š1 token â‰ˆ 4 å­—ç¬¦
  return Math.ceil(text.length / 4);
};

const inputText = $json.content;
const estimatedTokens = estimateTokens(inputText);

// å¦‚æœè¶…è¿‡é™åˆ¶ï¼Œæˆªæ–­æˆ–æ€»ç»“
if (estimatedTokens > 3000) {
  // ä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹å…ˆæ€»ç»“
  const summary = await summarizeWithCheaperModel(inputText);
  return summary;
} else {
  // ä½¿ç”¨ GPT-4
  return await processWithGPT4(inputText);
}
```

#### 3. é”™è¯¯å¤„ç†

```javascript
// AI è°ƒç”¨å¯èƒ½å¤±è´¥ï¼Œéœ€è¦é‡è¯•æœºåˆ¶
const maxRetries = 3;
let attempt = 0;

while (attempt < maxRetries) {
  try {
    const response = await callOpenAI(prompt);
    return response;
  } catch (error) {
    attempt++;
    if (attempt >= maxRetries) {
      // é™çº§ï¼šä½¿ç”¨ç¼“å­˜æˆ–é»˜è®¤å“åº”
      return getCachedResponse(prompt) || getDefaultResponse();
    }
    // æŒ‡æ•°é€€é¿
    await sleep(Math.pow(2, attempt) * 1000);
  }
}
```

---

## 8. è‡ªæ‰˜ç®¡æŒ‡å—

### 8.1 å®‰è£…æ–¹å¼å¯¹æ¯”

| æ–¹å¼ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **npx** | æœ€å¿«ï¼Œé›¶é…ç½® | ä¸´æ—¶ï¼Œæ— æŒä¹…åŒ– | å¿«é€Ÿæµ‹è¯• |
| **Docker** | éš”ç¦»ï¼Œæ˜“éƒ¨ç½² | éœ€è¦ Docker çŸ¥è¯† | ç”Ÿäº§ç¯å¢ƒ |
| **npm** | çµæ´»ï¼Œå¯å®šåˆ¶ | éœ€è¦ç®¡ç†ä¾èµ– | å¼€å‘ç¯å¢ƒ |
| **Docker Compose** | å®Œæ•´æ ˆï¼Œä¸€é”®å¯åŠ¨ | é…ç½®å¤æ‚ | ç”Ÿäº§ï¼ˆæ¨èï¼‰ |
| **Kubernetes** | é«˜å¯ç”¨ï¼Œå¯æ‰©å±• | å¤æ‚åº¦é«˜ | ä¼ä¸šçº§ |

### 8.2 Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### åŸºç¡€éƒ¨ç½²

```bash
# 1. åˆ›å»ºæ•°æ®å·
docker volume create n8n_data

# 2. è¿è¡Œå®¹å™¨
docker run -d \
  --name n8n \
  -p 5678:5678 \
  -e N8N_BASIC_AUTH_ACTIVE=true \
  -e N8N_BASIC_AUTH_USER=admin \
  -e N8N_BASIC_AUTH_PASSWORD=your_password \
  -v n8n_data:/home/node/.n8n \
  docker.n8n.io/n8nio/n8n

# 3. è®¿é—®
# http://localhost:5678
```

#### ç”Ÿäº§çº§ Docker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  postgres:
    image: postgres:15
    restart: unless-stopped
    environment:
      POSTGRES_USER: n8n
      POSTGRES_PASSWORD: ${DB_PASSWORD}
      POSTGRES_DB: n8n
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U n8n']
      interval: 5s
      timeout: 5s
      retries: 10

  n8n:
    image: docker.n8n.io/n8nio/n8n:latest
    restart: unless-stopped
    ports:
      - "5678:5678"
    environment:
      # æ•°æ®åº“
      - DB_TYPE=postgresdb
      - DB_POSTGRESDB_HOST=postgres
      - DB_POSTGRESDB_PORT=5432
      - DB_POSTGRESDB_DATABASE=n8n
      - DB_POSTGRESDB_USER=n8n
      - DB_POSTGRESDB_PASSWORD=${DB_PASSWORD}

      # åŸºç¡€é…ç½®
      - N8N_PROTOCOL=https
      - N8N_HOST=${DOMAIN}
      - N8N_PORT=5678
      - N8N_ENCRYPTION_KEY=${ENCRYPTION_KEY}

      # è®¤è¯
      - N8N_BASIC_AUTH_ACTIVE=true
      - N8N_BASIC_AUTH_USER=${AUTH_USER}
      - N8N_BASIC_AUTH_PASSWORD=${AUTH_PASSWORD}

      # æ‰§è¡Œé…ç½®
      - EXECUTIONS_MODE=queue
      - EXECUTIONS_DATA_SAVE_ON_ERROR=all
      - EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
      - EXECUTIONS_DATA_MAX_AGE=336  # 14 days

      # Webhook
      - WEBHOOK_URL=https://${DOMAIN}/

      # æ—¶åŒº
      - GENERIC_TIMEZONE=Asia/Shanghai

      # API
      - N8N_API_ENABLED=true

    volumes:
      - n8n_data:/home/node/.n8n
      - ./workflows:/home/node/.n8n/workflows  # å·¥ä½œæµå¤‡ä»½
    depends_on:
      postgres:
        condition: service_healthy

  # Redisï¼ˆç”¨äºé˜Ÿåˆ—ï¼‰
  redis:
    image: redis:7
    restart: unless-stopped
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  n8n_data:
  redis_data:
```

```bash
# .env æ–‡ä»¶
DB_PASSWORD=your_secure_password
ENCRYPTION_KEY=your_32_char_encryption_key
DOMAIN=n8n.yourdomain.com
AUTH_USER=admin
AUTH_PASSWORD=your_auth_password
```

### 8.3 ç¯å¢ƒå˜é‡è¯¦è§£

```bash
# æ•°æ®åº“é…ç½®
DB_TYPE=postgresdb                    # sqlite, postgresdb, mysqldb, mariadb
DB_POSTGRESDB_HOST=localhost
DB_POSTGRESDB_PORT=5432
DB_POSTGRESDB_DATABASE=n8n
DB_POSTGRESDB_USER=n8n
DB_POSTGRESDB_PASSWORD=password

# å®‰å…¨
N8N_ENCRYPTION_KEY=your_key           # åŠ å¯†å‡­è¯
N8N_BASIC_AUTH_ACTIVE=true            # å¯ç”¨åŸºç¡€è®¤è¯
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=password

# ç½‘ç»œ
N8N_PROTOCOL=https                    # http æˆ– https
N8N_HOST=n8n.yourdomain.com
N8N_PORT=5678
WEBHOOK_URL=https://n8n.yourdomain.com/

# æ‰§è¡Œ
EXECUTIONS_MODE=regular               # regular æˆ– queue
EXECUTIONS_TIMEOUT=300                # ç§’
EXECUTIONS_TIMEOUT_MAX=3600
N8N_LOG_LEVEL=info                    # error, warn, info, verbose, debug

# æ€§èƒ½
N8N_PAYLOAD_SIZE_MAX=16               # MB
N8N_METRICS=true                      # å¯ç”¨ç›‘æ§æŒ‡æ ‡

# å¤–éƒ¨æœåŠ¡
N8N_EXTERNAL_STORAGE_S3_HOST=s3.amazonaws.com  # æ–‡ä»¶å­˜å‚¨
N8N_EXTERNAL_STORAGE_S3_BUCKET=n8n-files
```

### 8.4 SSL/HTTPS é…ç½®

#### ä½¿ç”¨ Nginx åå‘ä»£ç†

```nginx
# /etc/nginx/sites-available/n8n
server {
    listen 80;
    server_name n8n.yourdomain.com;

    # Redirect to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name n8n.yourdomain.com;

    # SSL è¯ä¹¦ï¼ˆLet's Encryptï¼‰
    ssl_certificate /etc/letsencrypt/live/n8n.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/n8n.yourdomain.com/privkey.pem;

    # SSL ä¼˜åŒ–
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # åå‘ä»£ç†
    location / {
        proxy_pass http://localhost:5678;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocket æ”¯æŒï¼ˆé‡è¦ï¼ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        # è¶…æ—¶é…ç½®
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }
}
```

```bash
# è‡ªåŠ¨è·å– SSL è¯ä¹¦
sudo certbot --nginx -d n8n.yourdomain.com
```

### 8.5 å¤‡ä»½ç­–ç•¥

```bash
# 1. æ•°æ®åº“å¤‡ä»½
docker exec n8n_postgres_1 pg_dump -U n8n n8n > backup-$(date +%Y%m%d).sql

# 2. å·¥ä½œæµå¤‡ä»½
docker cp n8n:/home/node/.n8n/workflows ./workflows-backup-$(date +%Y%m%d)

# 3. å‡­è¯å¤‡ä»½ï¼ˆåŠ å¯†ï¼‰
docker cp n8n:/home/node/.n8n/credentials.json ./credentials-backup-$(date +%Y%m%d).json

# 4. è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬
cat > backup-n8n.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/backups/n8n"
DATE=$(date +%Y%m%d)

# æ•°æ®åº“
docker exec n8n_postgres_1 pg_dump -U n8n n8n | gzip > "$BACKUP_DIR/db-$DATE.sql.gz"

# å·¥ä½œæµ
docker cp n8n:/home/node/.n8n/workflows "$BACKUP_DIR/workflows-$DATE"
tar -czf "$BACKUP_DIR/workflows-$DATE.tar.gz" "$BACKUP_DIR/workflows-$DATE"
rm -rf "$BACKUP_DIR/workflows-$DATE"

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™ 30 å¤©ï¼‰
find "$BACKUP_DIR" -name "*.gz" -mtime +30 -delete

echo "Backup completed: $DATE"
EOF

chmod +x backup-n8n.sh

# æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹ï¼‰
0 2 * * * /path/to/backup-n8n.sh
```

### 8.6 ç›‘æ§ä¸ç»´æŠ¤

```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs -f n8n

# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats n8n

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:5678/healthz

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
docker pull docker.n8n.io/n8nio/n8n:latest
docker-compose down
docker-compose up -d

# æ•°æ®åº“ç»´æŠ¤
docker exec -it n8n_postgres_1 psql -U n8n -c "VACUUM FULL;"
```

---

## 9. é«˜çº§ç‰¹æ€§

### 9.1 Webhook æ·±åº¦ä½¿ç”¨

#### åŸºç¡€ Webhook

```
Webhook URL: https://n8n.yourdomain.com/webhook/unique-id

POST /webhook/user-signup
{
  "email": "user@example.com",
  "name": "John Doe"
}

n8n å·¥ä½œæµï¼š
[Webhook Trigger] â†’ [Validate Data] â†’ [Save to DB] â†’ [Send Welcome Email]
```

#### é«˜çº§ Webhook åŠŸèƒ½

```javascript
// 1. éªŒè¯ç­¾åï¼ˆGitHub/Stripe é£æ ¼ï¼‰
const crypto = require('crypto');

const signature = $webhookHeaders['x-hub-signature-256'];
const payload = JSON.stringify($input.all()[0].json);
const secret = $env.WEBHOOK_SECRET;

const expectedSignature = 'sha256=' + crypto
  .createHmac('sha256', secret)
  .update(payload)
  .digest('hex');

if (signature !== expectedSignature) {
  throw new Error('Invalid signature');
}

return $input.all();
```

```javascript
// 2. IP ç™½åå•
const allowedIPs = ['192.168.1.100', '203.0.113.0'];
const clientIP = $webhookHeaders['x-forwarded-for'] || $webhookHeaders['x-real-ip'];

if (!allowedIPs.includes(clientIP)) {
  throw new Error('Unauthorized IP');
}
```

```javascript
// 3. è‡ªå®šä¹‰å“åº”
// åœ¨ Webhook èŠ‚ç‚¹è®¾ç½®
{
  "options": {
    "responseCode": 200,
    "responseData": "Success",
    "responseHeaders": {
      "Content-Type": "application/json"
    }
  }
}

// åœ¨ Code èŠ‚ç‚¹ä¸­è¿”å›è‡ªå®šä¹‰å“åº”
return [{
  json: {
    success: true,
    message: "Data processed",
    id: processedId
  }
}];
```

### 9.2 å­å·¥ä½œæµ

```
ä¸»å·¥ä½œæµå¯ä»¥è°ƒç”¨å…¶ä»–å·¥ä½œæµä½œä¸ºå­æ¨¡å—

Main Workflow:
  [Trigger]
       â†“
  [Execute Workflow: Validate User]
       â†“
  [Execute Workflow: Process Payment]
       â†“
  [Execute Workflow: Send Notifications]

ä¼˜åŠ¿ï¼š
- ä»£ç å¤ç”¨
- æ˜“äºæµ‹è¯•
- æ¨¡å—åŒ–ç®¡ç†
```

#### è°ƒç”¨å­å·¥ä½œæµ

```javascript
// Execute Workflow èŠ‚ç‚¹é…ç½®
{
  "workflowId": "123",  // å­å·¥ä½œæµ ID
  "waitForExecution": true,  // ç­‰å¾…å­å·¥ä½œæµå®Œæˆ
  "input": {
    "userId": "={{ $json.userId }}",
    "action": "process"
  }
}

// è·å–å­å·¥ä½œæµè¿”å›å€¼
const result = $node["Execute Workflow"].json;
```

### 9.3 é”™è¯¯å¤„ç†å·¥ä½œæµ

```
[Error Trigger] â†’ æ•è·ä»»ä½•å·¥ä½œæµçš„é”™è¯¯
     â†“
[Code: åˆ†æé”™è¯¯]
     â†“
[Branch: é”™è¯¯ç±»å‹ï¼Ÿ]
     â”œâ”€ Network Error â†’ [Retry Workflow]
     â”œâ”€ Data Error â†’ [Notify Admin]
     â””â”€ Unknown â†’ [Log to Sentry] â†’ [Slack Alert]
```

```javascript
// Error Trigger å¯è®¿é—®çš„æ•°æ®
{
  "execution": {
    "id": "12345",
    "retryOf": null,
    "mode": "trigger",
    "startedAt": "2025-01-01T00:00:00.000Z",
    "stoppedAt": "2025-01-01T00:05:00.000Z",
    "workflowId": "67890",
    "workflowData": {...}
  },
  "error": {
    "message": "Connection timeout",
    "stack": "Error: Connection timeout\n    at ...",
    "node": "HTTP Request"
  }
}
```

### 9.4 æ‰¹å¤„ç†ä¼˜åŒ–

```
é—®é¢˜ï¼šå¤„ç† 10,000 æ¡è®°å½•ï¼ŒAPI æœ‰é¢‘ç‡é™åˆ¶

âŒ ä¸å¥½ï¼š
[Get 10000 Items] â†’ [Loop: API Call] â†’ 10000 æ¬¡è¯·æ±‚ â†’ è¶…æ—¶/å¤±è´¥

âœ… å¥½ï¼š
[Get 10000 Items]
     â†“
[Split In Batches: 100 items]
     â†“
[HTTP Request: Batch API] â†’ 100 æ¬¡è¯·æ±‚
     â†“
[Wait: 1 second]  // é¿å…é¢‘ç‡é™åˆ¶
     â†“
[Loop back if more batches]
     â†“
[Merge Results]
```

### 9.5 ç¼“å­˜ç­–ç•¥

```javascript
// ä½¿ç”¨ Redis ç¼“å­˜ API å“åº”
const redis = require('redis');
const client = redis.createClient({ url: process.env.REDIS_URL });

await client.connect();

const cacheKey = `api:user:${userId}`;

// æ£€æŸ¥ç¼“å­˜
let userData = await client.get(cacheKey);

if (!userData) {
  // ç¼“å­˜æœªå‘½ä¸­ï¼Œè°ƒç”¨ API
  const response = await axios.get(`https://api.example.com/user/${userId}`);
  userData = JSON.stringify(response.data);

  // å­˜å…¥ç¼“å­˜ï¼Œ1 å°æ—¶è¿‡æœŸ
  await client.setEx(cacheKey, 3600, userData);
}

return [{ json: JSON.parse(userData) }];
```

---

## 10. æ€§èƒ½ä¼˜åŒ–

### 10.1 å·¥ä½œæµä¼˜åŒ–

#### 1. å‡å°‘èŠ‚ç‚¹æ•°é‡

```
âŒ ä¸å¥½ï¼ˆ8 ä¸ªèŠ‚ç‚¹ï¼‰ï¼š
[HTTP Request] â†’ [Set] â†’ [Set] â†’ [Set] â†’ [IF] â†’ [Set] â†’ [Set] â†’ [HTTP Request]

âœ… å¥½ï¼ˆ3 ä¸ªèŠ‚ç‚¹ï¼‰ï¼š
[HTTP Request] â†’ [Code: åˆå¹¶æ‰€æœ‰é€»è¾‘] â†’ [HTTP Request]
```

#### 2. å¹¶è¡Œæ‰§è¡Œ

```
ä¸²è¡Œï¼ˆæ…¢ï¼‰ï¼š
[Task A] â†’ [Task B] â†’ [Task C]  // 30 ç§’

å¹¶è¡Œï¼ˆå¿«ï¼‰ï¼š
       â”Œâ”€ [Task A] â”€â”
[Split]â”¼â”€ [Task B] â”€â”¼ [Merge]  // 10 ç§’
       â””â”€ [Task C] â”€â”˜
```

#### 3. æ•°æ®åº“ä¼˜åŒ–

```javascript
// âŒ ä¸å¥½ï¼šN+1 æŸ¥è¯¢
for (const user of users) {
  const orders = await db.query('SELECT * FROM orders WHERE userId = ?', [user.id]);
}

// âœ… å¥½ï¼šæ‰¹é‡æŸ¥è¯¢
const userIds = users.map(u => u.id);
const orders = await db.query('SELECT * FROM orders WHERE userId IN (?)', [userIds]);
const ordersMap = groupBy(orders, 'userId');
```

### 10.2 ç³»ç»Ÿé…ç½®ä¼˜åŒ–

#### Docker èµ„æºé™åˆ¶

```yaml
# docker-compose.yml
services:
  n8n:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
```

#### æ•°æ®åº“è°ƒä¼˜

```sql
-- PostgreSQL é…ç½®ä¼˜åŒ–
-- /var/lib/postgresql/data/postgresql.conf

shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 128MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
work_mem = 10MB
min_wal_size = 1GB
max_wal_size = 4GB
```

### 10.3 ç›‘æ§æŒ‡æ ‡

```javascript
// åœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ æ€§èƒ½ç›‘æ§
const startTime = Date.now();

// æ‰§è¡Œæ“ä½œ
const result = await heavyOperation();

const duration = Date.now() - startTime;

// è®°å½•åˆ°ç›‘æ§ç³»ç»Ÿï¼ˆPrometheus/Grafanaï¼‰
await axios.post('http://prometheus-pushgateway:9091/metrics/job/n8n', {
  metric: 'workflow_execution_duration',
  value: duration,
  labels: {
    workflow: $workflow.name,
    node: $node.name
  }
});
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒä»·å€¼

1. **è‡ªæ‰˜ç®¡** = æ•°æ®ä¸»æƒ + æ— é™æ‰§è¡Œ
2. **ä»£ç èƒ½åŠ›** = æ— é™å¯èƒ½æ€§
3. **AI åŸç”Ÿ** = æ™ºèƒ½è‡ªåŠ¨åŒ–
4. **å¼€æºç¤¾åŒº** = æŒç»­è¿›åŒ–

### å­¦ä¹ è·¯å¾„

```
ç¬¬ 1 å¤©ï¼šç†è§£æ ¸å¿ƒæ¦‚å¿µ
   â”œâ”€ Workflowã€Nodeã€Execution
   â””â”€ åˆ›å»ºç¬¬ä¸€ä¸ªç®€å•å·¥ä½œæµ

ç¬¬ 2-3 å¤©ï¼šæŒæ¡èŠ‚ç‚¹ç³»ç»Ÿ
   â”œâ”€ Triggerã€Actionã€Logic èŠ‚ç‚¹
   â””â”€ è¡¨è¾¾å¼å’Œæ•°æ®å¼•ç”¨

ç¬¬ 4-7 å¤©ï¼šé«˜çº§ç‰¹æ€§
   â”œâ”€ Code èŠ‚ç‚¹ï¼ˆJS/Pythonï¼‰
   â”œâ”€ Webhook å’Œ API
   â””â”€ å­å·¥ä½œæµå’Œé”™è¯¯å¤„ç†

ç¬¬ 2 å‘¨ï¼šAI é›†æˆ
   â”œâ”€ LangChain å·¥ä½œæµ
   â”œâ”€ RAG ç³»ç»Ÿ
   â””â”€ AI Agent ç¼–æ’

ç¬¬ 3-4 å‘¨ï¼šç”Ÿäº§éƒ¨ç½²
   â”œâ”€ Docker Compose éƒ¨ç½²
   â”œâ”€ SSL/HTTPS é…ç½®
   â”œâ”€ ç›‘æ§å’Œå¤‡ä»½
   â””â”€ æ€§èƒ½ä¼˜åŒ–
```

### ä¸‹ä¸€æ­¥

- é˜…è¯»ã€Šn8n_å¿«é€Ÿä¸Šæ‰‹æŒ‡å—.mdã€‹å¼€å§‹å®æˆ˜
- æŸ¥çœ‹ã€Šn8n_ä¸ä½ çš„é¡¹ç›®é›†æˆ.mdã€‹äº†è§£å®šåˆ¶æ–¹æ¡ˆ
- å‚è€ƒã€Šn8n_æœ€ä½³å®è·µ.mdã€‹ä¼˜åŒ–å·¥ä½œæµ

---

**n8n æ˜¯è‡ªåŠ¨åŒ–çš„ç»ˆæå·¥å…·ï¼ŒæŒæ¡å®ƒå°†è®©ä½ çš„ç”Ÿäº§åŠ›æå‡ 10 å€ï¼** ğŸš€
