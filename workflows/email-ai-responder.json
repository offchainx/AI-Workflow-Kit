{
  "name": "AIæ™ºèƒ½é‚®ä»¶è‡ªåŠ¨å›å¤",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "simple": false,
        "filters": {
          "isUnread": true,
          "labelIds": [
            "INBOX"
          ]
        },
        "options": {}
      },
      "name": "Gmailè§¦å‘å™¨",
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1,
      "position": [250, 300],
      "credentials": {
        "gmailOAuth2": {
          "id": "7",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// æå–é‚®ä»¶ä¿¡æ¯\nconst payload = $input.item.json.payload;\nconst headers = payload.headers;\n\n// è·å–å‘ä»¶äººã€ä¸»é¢˜ã€æ­£æ–‡\nconst from = headers.find(h => h.name === 'From')?.value || '';\nconst subject = headers.find(h => h.name === 'Subject')?.value || '';\nconst date = headers.find(h => h.name === 'Date')?.value || '';\n\n// è§£ææ­£æ–‡ï¼ˆæ”¯æŒHTMLå’Œçº¯æ–‡æœ¬ï¼‰\nlet body = '';\nif (payload.parts) {\n  const textPart = payload.parts.find(p => p.mimeType === 'text/plain');\n  if (textPart && textPart.body.data) {\n    body = Buffer.from(textPart.body.data, 'base64').toString('utf-8');\n  }\n} else if (payload.body.data) {\n  body = Buffer.from(payload.body.data, 'base64').toString('utf-8');\n}\n\nreturn {\n  json: {\n    messageId: $input.item.json.id,\n    threadId: $input.item.json.threadId,\n    from: from,\n    subject: subject,\n    body: body,\n    date: date,\n    snippet: $input.item.json.snippet\n  }\n};"
      },
      "name": "è§£æé‚®ä»¶å†…å®¹",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "jsCode": "// é‚®ä»¶åˆ†ç±»é€»è¾‘\nconst subject = $input.item.json.subject.toLowerCase();\nconst body = $input.item.json.body.toLowerCase();\nconst from = $input.item.json.from.toLowerCase();\n\n// å®šä¹‰è§„åˆ™\nconst rules = [\n  {\n    category: 'urgent',\n    keywords: ['urgent', 'ç´§æ€¥', 'asap', 'important', 'é‡è¦'],\n    shouldAutoReply: false\n  },\n  {\n    category: 'sales',\n    keywords: ['offer', 'discount', 'sale', 'ä¼˜æƒ ', 'ä¿ƒé”€'],\n    shouldAutoReply: true,\n    replyTemplate: 'sales'\n  },\n  {\n    category: 'support',\n    keywords: ['help', 'issue', 'problem', 'å¸®åŠ©', 'é—®é¢˜', 'bug'],\n    shouldAutoReply: true,\n    replyTemplate: 'support'\n  },\n  {\n    category: 'meeting',\n    keywords: ['meeting', 'schedule', 'calendar', 'ä¼šè®®', 'æ—¥ç¨‹'],\n    shouldAutoReply: true,\n    replyTemplate: 'meeting'\n  },\n  {\n    category: 'newsletter',\n    keywords: ['newsletter', 'unsubscribe', 'è®¢é˜…', 'é€€è®¢'],\n    shouldAutoReply: false\n  }\n];\n\nlet category = 'general';\nlet shouldAutoReply = true;\nlet replyTemplate = 'general';\n\nfor (const rule of rules) {\n  const hasKeyword = rule.keywords.some(keyword => \n    subject.includes(keyword) || body.includes(keyword)\n  );\n  \n  if (hasKeyword) {\n    category = rule.category;\n    shouldAutoReply = rule.shouldAutoReply;\n    replyTemplate = rule.replyTemplate || 'general';\n    break;\n  }\n}\n\nreturn {\n  json: {\n    ...$input.item.json,\n    category: category,\n    shouldAutoReply: shouldAutoReply,\n    replyTemplate: replyTemplate\n  }\n};"
      },
      "name": "æ™ºèƒ½åˆ†ç±»",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.shouldAutoReply }}",
              "value2": true
            }
          ]
        }
      },
      "name": "æ˜¯å¦è‡ªåŠ¨å›å¤",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "gpt-4"
            },
            {
              "name": "messages",
              "value": "={{ [{\\\"role\\\": \\\"system\\\", \\\"content\\\": \\\"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é‚®ä»¶åŠ©æ‰‹ã€‚æ ¹æ®ä»¥ä¸‹é‚®ä»¶å†…å®¹ç”Ÿæˆç¤¼è²Œã€ä¸“ä¸šçš„å›å¤ã€‚ç±»åˆ«: \" + $json.category}, {\\\"role\\\": \\\"user\\\", \\\"content\\\": \\\"å‘ä»¶äºº: \" + $json.from + \\\"\\\\nä¸»é¢˜: \" + $json.subject + \\\"\\\\næ­£æ–‡: \" + $json.body + \\\"\\\\n\\\\nè¯·ç”Ÿæˆä¸€å°ç®€æ´ã€ä¸“ä¸šçš„å›å¤é‚®ä»¶ã€‚\\\"}] }}"
            },
            {
              "name": "temperature",
              "value": 0.7
            }
          ]
        }
      },
      "name": "AIç”Ÿæˆå›å¤",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1050, 200],
      "credentials": {
        "openAiApi": {
          "id": "2",
          "name": "OpenAI account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const aiReply = $input.item.json.choices[0].message.content;\nconst originalEmail = $node[\"æ™ºèƒ½åˆ†ç±»\"].json;\n\nreturn {\n  json: {\n    ...originalEmail,\n    replyContent: aiReply\n  }\n};"
      },
      "name": "å‡†å¤‡å›å¤å†…å®¹",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 200]
    },
    {
      "parameters": {
        "sendTo": "={{ $json.from }}",
        "subject": "=Re: {{ $json.subject }}",
        "message": "={{ $json.replyContent }}",
        "options": {
          "replyToThread": "={{ $json.threadId }}"
        }
      },
      "name": "å‘é€Gmailå›å¤",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [1450, 200],
      "credentials": {
        "gmailOAuth2": {
          "id": "7",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "operation": "addLabel",
        "messageId": "={{ $json.messageId }}",
        "labelIds": [
          "Label_1"
        ]
      },
      "name": "æ ‡è®°ä¸ºå·²å¤„ç†",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [1650, 200],
      "credentials": {
        "gmailOAuth2": {
          "id": "7",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "YOUR_CHAT_ID",
        "text": "=ğŸ“§ é‚®ä»¶å·²è‡ªåŠ¨å›å¤\n\nå‘ä»¶äºº: {{ $json.from }}\nä¸»é¢˜: {{ $json.subject }}\nç±»åˆ«: {{ $json.category }}\n\nå›å¤å†…å®¹:\n{{ $json.replyContent }}",
        "additionalFields": {}
      },
      "name": "é€šçŸ¥ç®¡ç†å‘˜",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1050, 400],
      "credentials": {
        "telegramApi": {
          "id": "4",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "insert",
        "table": "email_log",
        "columns": "message_id,from_email,subject,category,auto_replied,created_at",
        "additionalFields": {}
      },
      "name": "è®°å½•å¤„ç†æ—¥å¿—",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1250, 400],
      "credentials": {
        "supabaseApi": {
          "id": "3",
          "name": "Supabase account"
        }
      }
    }
  ],
  "connections": {
    "Gmailè§¦å‘å™¨": {
      "main": [
        [
          {
            "node": "è§£æé‚®ä»¶å†…å®¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æé‚®ä»¶å†…å®¹": {
      "main": [
        [
          {
            "node": "æ™ºèƒ½åˆ†ç±»",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ™ºèƒ½åˆ†ç±»": {
      "main": [
        [
          {
            "node": "æ˜¯å¦è‡ªåŠ¨å›å¤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ˜¯å¦è‡ªåŠ¨å›å¤": {
      "main": [
        [
          {
            "node": "AIç”Ÿæˆå›å¤",
            "type": "main",
            "index": 0
          },
          {
            "node": "é€šçŸ¥ç®¡ç†å‘˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AIç”Ÿæˆå›å¤": {
      "main": [
        [
          {
            "node": "å‡†å¤‡å›å¤å†…å®¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡å›å¤å†…å®¹": {
      "main": [
        [
          {
            "node": "å‘é€Gmailå›å¤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‘é€Gmailå›å¤": {
      "main": [
        [
          {
            "node": "æ ‡è®°ä¸ºå·²å¤„ç†",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ ‡è®°ä¸ºå·²å¤„ç†": {
      "main": [
        [
          {
            "node": "è®°å½•å¤„ç†æ—¥å¿—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "é€šçŸ¥ç®¡ç†å‘˜": {
      "main": [
        [
          {
            "node": "è®°å½•å¤„ç†æ—¥å¿—",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "id": "4",
      "name": "é‚®ä»¶è‡ªåŠ¨åŒ–"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-10-24T00:00:00.000Z",
  "versionId": "1"
}
